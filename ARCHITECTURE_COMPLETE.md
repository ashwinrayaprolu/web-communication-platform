# VoIP System Architecture - Complete Guide

## ğŸ“Š System Overview

This is a **production-grade VoIP platform** with 16 microservices providing:
- âœ… WebRTC calling
- âœ… SIP trunk connectivity
- âœ… IVR (Interactive Voice Response)
- âœ… Natural TTS (Text-to-Speech)
- âœ… Video conferencing
- âœ… Real-time monitoring
- âœ… Call recording & analytics

---

## ğŸ—ï¸ High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACES                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Web Browser  â”‚  SIP Phone  â”‚  Mobile App  â”‚  Admin Dashboard       â”‚
â”‚  (WebRTC)     â”‚  (SIP)      â”‚  (WebRTC)    â”‚  (Management)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚              â”‚              â”‚                 â”‚
        â–¼              â–¼              â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         NGINX (Reverse Proxy)                        â”‚
â”‚  Ports: 80 (HTTP), 443 (HTTPS), 8080 (WebSocket)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚              â”‚              â”‚                 â”‚
         â”‚              â”‚              â”‚                 â–¼
         â”‚              â”‚              â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚              â”‚              â”‚         â”‚ Admin Dashboard  â”‚
         â”‚              â”‚              â”‚         â”‚ Port: 3000       â”‚
         â”‚              â”‚              â”‚         â”‚ â€¢ API Backend    â”‚
         â”‚              â”‚              â”‚         â”‚ â€¢ Web UI         â”‚
         â”‚              â”‚              â”‚         â”‚ â€¢ Monitoring     â”‚
         â”‚              â”‚              â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚              â”‚              â”‚
         â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SIP SIGNALING LAYER                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚              KAMAILIO (SIP Proxy)                       â”‚        â”‚
â”‚  â”‚              Port: 5060 (SIP), 8080 (WebSocket)         â”‚        â”‚
â”‚  â”‚                                                          â”‚        â”‚
â”‚  â”‚  â€¢ Load Balancer                                        â”‚        â”‚
â”‚  â”‚  â€¢ WebRTC Gateway                                       â”‚        â”‚
â”‚  â”‚  â€¢ SIP Routing                                          â”‚        â”‚
â”‚  â”‚  â€¢ NAT Traversal                                        â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚               â”‚                        â”‚                             â”‚
â”‚               â–¼                        â–¼                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  Drachtio Server  â”‚    â”‚  Drachtio Server  â”‚                    â”‚
â”‚  â”‚  (Instance 1)     â”‚    â”‚  (Instance 2)     â”‚                    â”‚
â”‚  â”‚  Port: 5080       â”‚    â”‚  Port: 5081       â”‚                    â”‚
â”‚  â”‚  Control: 9022    â”‚    â”‚  Control: 9023    â”‚                    â”‚
â”‚  â”‚                   â”‚    â”‚                   â”‚                    â”‚
â”‚  â”‚  â€¢ SIP Server     â”‚    â”‚  â€¢ SIP Server     â”‚                    â”‚
â”‚  â”‚  â€¢ Call Control   â”‚    â”‚  â€¢ Call Control   â”‚                    â”‚
â”‚  â”‚  â€¢ High Avail.    â”‚    â”‚  â€¢ High Avail.    â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚            â”‚                        â”‚                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                        â”‚
             â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    APPLICATION LOGIC LAYER                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Drachtio App 1 (Node.js)    â”‚  â”‚   Drachtio App 2          â”‚  â”‚
â”‚  â”‚   Port: 3001                  â”‚  â”‚   Port: 3002              â”‚  â”‚
â”‚  â”‚                               â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚  â€¢ Call Routing               â”‚  â”‚  â€¢ Call Routing           â”‚  â”‚
â”‚  â”‚  â€¢ IVR Logic                  â”‚  â”‚  â€¢ IVR Logic              â”‚  â”‚
â”‚  â”‚  â€¢ DTMF Handling              â”‚  â”‚  â€¢ DTMF Handling          â”‚  â”‚
â”‚  â”‚  â€¢ TTS Integration            â”‚  â”‚  â€¢ TTS Integration        â”‚  â”‚
â”‚  â”‚  â€¢ Database Queries           â”‚  â”‚  â€¢ Database Queries       â”‚  â”‚
â”‚  â”‚  â€¢ Call Logging               â”‚  â”‚  â€¢ Call Logging           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚          â”‚                                  â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                  â”‚
           â–¼                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MEDIA PROCESSING LAYER                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  FreeSWITCH 1            â”‚    â”‚  FreeSWITCH 2            â”‚      â”‚
â”‚  â”‚  Port: 5062 (SIP)        â”‚    â”‚  Port: 5063 (SIP)        â”‚      â”‚
â”‚  â”‚  ESL: 8021               â”‚    â”‚  ESL: 8021               â”‚      â”‚
â”‚  â”‚  RTP: 16384-16583        â”‚    â”‚  RTP: 16584-16783        â”‚      â”‚
â”‚  â”‚                          â”‚    â”‚                          â”‚      â”‚
â”‚  â”‚  â€¢ Media Server          â”‚    â”‚  â€¢ Media Server          â”‚      â”‚
â”‚  â”‚  â€¢ RTP Handler           â”‚    â”‚  â€¢ RTP Handler           â”‚      â”‚
â”‚  â”‚  â€¢ Audio Processing      â”‚    â”‚  â€¢ Audio Processing      â”‚      â”‚
â”‚  â”‚  â€¢ Tone Generation       â”‚    â”‚  â€¢ Tone Generation       â”‚      â”‚
â”‚  â”‚  â€¢ DTMF Detection        â”‚    â”‚  â€¢ DTMF Detection        â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚              RTPEngine (Media Gateway)                    â”‚      â”‚
â”‚  â”‚              Port: 22222 (Control), 30000-30100 (RTP)     â”‚      â”‚
â”‚  â”‚                                                            â”‚      â”‚
â”‚  â”‚  â€¢ WebRTC â†” RTP Bridge                                   â”‚      â”‚
â”‚  â”‚  â€¢ Media Transcoding                                      â”‚      â”‚
â”‚  â”‚  â€¢ NAT Traversal (ICE/STUN/TURN)                         â”‚      â”‚
â”‚  â”‚  â€¢ Media Recording                                        â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚              TTS Service (Piper)                          â”‚      â”‚
â”‚  â”‚              Port: 8000 (HTTP API)                        â”‚      â”‚
â”‚  â”‚                                                            â”‚      â”‚
â”‚  â”‚  â€¢ Text-to-Speech Generation                             â”‚      â”‚
â”‚  â”‚  â€¢ Natural Voice (Neural TTS)                            â”‚      â”‚
â”‚  â”‚  â€¢ WAV File Output                                       â”‚      â”‚
â”‚  â”‚  â€¢ Caching System                                        â”‚      â”‚
â”‚  â”‚  â€¢ Multi-voice Support                                   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VIDEO CONFERENCING LAYER                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚              LiveKit (WebRTC SFU)                         â”‚      â”‚
â”‚  â”‚              Port: 7880 (HTTP), 7881 (HTTPS)              â”‚      â”‚
â”‚  â”‚                                                            â”‚      â”‚
â”‚  â”‚  â€¢ Selective Forwarding Unit                             â”‚      â”‚
â”‚  â”‚  â€¢ Video Rooms                                           â”‚      â”‚
â”‚  â”‚  â€¢ Multi-party Conferencing                              â”‚      â”‚
â”‚  â”‚  â€¢ Screen Sharing                                        â”‚      â”‚
â”‚  â”‚  â€¢ Recording                                             â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DATA LAYER                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   PostgreSQL       â”‚           â”‚      Redis        â”‚            â”‚
â”‚  â”‚   Port: 5432       â”‚           â”‚      Port: 6379   â”‚            â”‚
â”‚  â”‚                    â”‚           â”‚                   â”‚            â”‚
â”‚  â”‚  â€¢ Call Logs       â”‚           â”‚  â€¢ Session Cache  â”‚            â”‚
â”‚  â”‚  â€¢ IVR Menus       â”‚           â”‚  â€¢ Call State     â”‚            â”‚
â”‚  â”‚  â€¢ Agent Data      â”‚           â”‚  â€¢ Rate Limiting  â”‚            â”‚
â”‚  â”‚  â€¢ Analytics       â”‚           â”‚  â€¢ Pub/Sub        â”‚            â”‚
â”‚  â”‚  â€¢ CDR Storage     â”‚           â”‚  â€¢ Real-time Data â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MANAGEMENT TOOLS                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   pgAdmin      â”‚  â”‚  dSIPRouter  â”‚  â”‚  Admin Dashboard â”‚        â”‚
â”‚  â”‚   Port: 5050   â”‚  â”‚  Port: 5000  â”‚  â”‚  Port: 3000      â”‚        â”‚
â”‚  â”‚                â”‚  â”‚              â”‚  â”‚                  â”‚        â”‚
â”‚  â”‚  â€¢ DB Mgmt     â”‚  â”‚  â€¢ SIP Mgmt  â”‚  â”‚  â€¢ Monitoring    â”‚        â”‚
â”‚  â”‚  â€¢ SQL Client  â”‚  â”‚  â€¢ Routing   â”‚  â”‚  â€¢ Analytics     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Call Flow Diagrams

### **WebRTC Call Flow**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser  â”‚                                                    â”‚ Browser  â”‚
â”‚ (Alice)  â”‚                                                    â”‚  (Bob)   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                                                                â”‚
     â”‚ 1. INVITE (WebRTC SDP)                                        â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                  via Kamailio â†’ Drachtio                      â”‚
     â”‚                                                                â”‚
     â”‚ 2. 100 Trying                                                 â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                                                                â”‚
     â”‚ 3. 180 Ringing                                                â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                                                                â”‚
     â”‚ 4. 200 OK (WebRTC SDP)                                        â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                                                                â”‚
     â”‚ 5. ACK                                                         â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                                                                â”‚
     â”‚                                                                â”‚
     â”‚ 6. Media Flow (RTP/SRTP)                                      â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚              via RTPEngine                                     â”‚
     â”‚         (WebRTC â†” RTP transcoding)                            â”‚
     â”‚                                                                â”‚
     â”‚ 7. BYE                                                         â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                                                                â”‚
     â”‚ 8. 200 OK                                                      â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                                                                â”‚
```

### **IVR Call Flow (Extension 9999)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser  â”‚    â”‚ Kamailio â”‚    â”‚ Drachtio â”‚    â”‚   App    â”‚    â”‚   TTS    â”‚
â”‚          â”‚    â”‚          â”‚    â”‚  Server  â”‚    â”‚ (Node.js)â”‚    â”‚ Service  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚ INVITE 9999   â”‚               â”‚               â”‚               â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚ INVITE        â”‚               â”‚               â”‚
     â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚               â”‚
     â”‚               â”‚               â”‚ handleIVRCall â”‚               â”‚
     â”‚               â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚               â”‚               â”‚ connectCaller â”‚
     â”‚               â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ (FreeSWITCH) â”‚
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚ 200 OK        â”‚               â”‚               â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
     â”‚                                               â”‚               â”‚
     â”‚ ACK                                           â”‚               â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
     â”‚                                               â”‚               â”‚
     â”‚                                               â”‚ POST /tts     â”‚
     â”‚                                               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                                               â”‚ {text: "..."}â”‚
     â”‚                                               â”‚               â”‚
     â”‚                                               â”‚ file_path     â”‚
     â”‚                                               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                                               â”‚ /output/      â”‚
     â”‚                                               â”‚ abc.wav       â”‚
     â”‚                                               â”‚               â”‚
     â”‚                                               â”‚ endpoint.play â”‚
     â”‚                                               â”‚ (abc.wav)     â”‚
     â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
     â”‚ [TTS Audio: "Welcome to our service..."]      â”‚               â”‚
     â”‚                                               â”‚               â”‚
     â”‚ [User presses DTMF: 1]                        â”‚               â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
     â”‚                                               â”‚               â”‚
     â”‚                                               â”‚ handleDTMF(1) â”‚
     â”‚                                               â”‚               â”‚
     â”‚                                               â”‚ POST /tts     â”‚
     â”‚                                               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                                               â”‚               â”‚
     â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
     â”‚ [TTS Audio: "Transferring to sales..."]       â”‚               â”‚
     â”‚                                               â”‚               â”‚
```

---

## ğŸ“¦ Service Inventory (16 Services)

### **Layer 1: Core Infrastructure (2 services)**

| # | Service | Port(s) | Purpose |
|---|---------|---------|---------|
| 1 | **PostgreSQL** | 5432 | Primary database for call logs, IVR config, agents |
| 2 | **Redis** | 6379 | Session cache, real-time state, pub/sub |

### **Layer 2: SIP Signaling (5 services)**

| # | Service | Port(s) | Purpose |
|---|---------|---------|---------|
| 3 | **Kamailio** | 5060, 8080 | SIP proxy, load balancer, WebRTC gateway |
| 4 | **Drachtio-1** | 5080, 9022 | SIP server instance 1 |
| 5 | **Drachtio-2** | 5081, 9023 | SIP server instance 2 (HA) |
| 6 | **Drachtio-App-1** | 3001 | Call logic, IVR, routing (Node.js) |
| 7 | **Drachtio-App-2** | 3002 | Call logic, IVR, routing (Node.js HA) |

### **Layer 3: Media Processing (4 services)**

| # | Service | Port(s) | Purpose |
|---|---------|---------|---------|
| 8 | **FreeSWITCH-1** | 5062, 8021, 16384-16583 | Media server, RTP, tones |
| 9 | **FreeSWITCH-2** | 5063, 8021, 16584-16783 | Media server (HA) |
| 10 | **RTPEngine** | 22222, 30000-30100 | WebRTCâ†”RTP bridge, NAT traversal |
| 11 | **TTS Service** | 8000 | Text-to-speech (Piper neural TTS) |

### **Layer 4: Video & Conferencing (1 service)**

| # | Service | Port(s) | Purpose |
|---|---------|---------|---------|
| 12 | **LiveKit** | 7880, 7881 | WebRTC SFU, video conferencing |

### **Layer 5: Management & Web (4 services)**

| # | Service | Port(s) | Purpose |
|---|---------|---------|---------|
| 13 | **NGINX** | 80, 443 | Reverse proxy, static files |
| 14 | **Admin Dashboard** | 3000 | Monitoring UI & API |
| 15 | **dSIPRouter** | 5000 | SIP routing management |
| 16 | **pgAdmin** | 5050 | Database administration |

---

## ğŸ”Œ Port Mapping Reference

```
External â†’ Internal Port Mappings

WEB & API:
80      â†’ nginx:80           (HTTP)
443     â†’ nginx:443          (HTTPS - if configured)

SIP SIGNALING:
5060    â†’ kamailio:5060      (SIP UDP/TCP)
5080    â†’ drachtio-1:5060    (SIP)
5081    â†’ drachtio-2:5060    (SIP)
5062    â†’ freeswitch-1:5060  (SIP)
5063    â†’ freeswitch-2:5060  (SIP)

WEBSOCKET:
8080    â†’ kamailio:8080      (WebSocket)

MEDIA (RTP):
16384-16583  â†’ freeswitch-1   (RTP)
16584-16783  â†’ freeswitch-2   (RTP)
30000-30100  â†’ rtpengine      (RTP)

MANAGEMENT:
5050    â†’ pgadmin:80         (DB Admin)
5432    â†’ postgres:5432      (Database)
6379    â†’ redis:6379         (Cache)

CONTROL:
8021    â†’ freeswitch:8021    (Event Socket)
9022    â†’ drachtio-1:9022    (Control)
9023    â†’ drachtio-2:9023    (Control)
22222   â†’ rtpengine:22222    (Control)

APPLICATION:
3000    â†’ admin-dashboard    (Dashboard)
3001    â†’ drachtio-app-1     (App)
3002    â†’ drachtio-app-2     (App)
5000    â†’ dsiprouter         (SIP Router)
7880    â†’ livekit            (Video)
8000    â†’ tts-service        (TTS API)
```

---

## ğŸ’¾ Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATA PERSISTENCE                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PostgreSQL Database (voip_db)
â”œâ”€â”€ call_logs                 # All call records (CDR)
â”‚   â”œâ”€â”€ call_id              # Unique identifier
â”‚   â”œâ”€â”€ from_number          # Caller ID
â”‚   â”œâ”€â”€ to_number            # Destination
â”‚   â”œâ”€â”€ status               # answered/missed/completed
â”‚   â”œâ”€â”€ start_time           # When call started
â”‚   â”œâ”€â”€ end_time             # When call ended
â”‚   â”œâ”€â”€ duration             # Call length (seconds)
â”‚   â””â”€â”€ recording_url        # Audio file path
â”‚
â”œâ”€â”€ ivr_menus                 # IVR configuration
â”‚   â”œâ”€â”€ menu_id              # Menu identifier (e.g., "main")
â”‚   â”œâ”€â”€ name                 # Display name
â”‚   â””â”€â”€ welcome_message      # TTS prompt text
â”‚
â”œâ”€â”€ ivr_menu_options          # DTMF options
â”‚   â”œâ”€â”€ menu_id              # Which menu
â”‚   â”œâ”€â”€ digit                # Key pressed (1-9, *, #)
â”‚   â”œâ”€â”€ action_type          # menu/transfer/hangup
â”‚   â””â”€â”€ action_value         # What to do
â”‚
â”œâ”€â”€ agents                    # Agent management
â”‚   â”œâ”€â”€ extension            # SIP extension
â”‚   â”œâ”€â”€ name                 # Agent name
â”‚   â”œâ”€â”€ email                # Contact
â”‚   â”œâ”€â”€ status               # online/offline/busy
â”‚   â”œâ”€â”€ current_calls        # Active call count
â”‚   â””â”€â”€ total_calls          # Lifetime calls
â”‚
â””â”€â”€ active_calls              # Real-time call state
    â”œâ”€â”€ call_id
    â”œâ”€â”€ from_number
    â”œâ”€â”€ to_number
    â”œâ”€â”€ agent_extension
    â”œâ”€â”€ status
    â””â”€â”€ started_at

Redis Cache
â”œâ”€â”€ room:{call_id}           # LiveKit room info
â”‚   â”œâ”€â”€ roomName
â”‚   â”œâ”€â”€ token
â”‚   â””â”€â”€ participants
â”‚
â”œâ”€â”€ session:{uuid}           # Active sessions
â”‚   â”œâ”€â”€ call_id
â”‚   â”œâ”€â”€ state
â”‚   â””â”€â”€ last_activity
â”‚
â””â”€â”€ tts_cache:{hash}         # Cached TTS audio
    â”œâ”€â”€ file_path
    â””â”€â”€ generated_at

File System
â”œâ”€â”€ /app/output/             # TTS generated files (shared volume)
â”‚   â””â”€â”€ {uuid}.wav
â”‚
â”œâ”€â”€ /freeswitch/recordings/  # Call recordings
â”‚   â””â”€â”€ {call_id}.wav
â”‚
â””â”€â”€ /var/log/               # Application logs
    â”œâ”€â”€ nginx/
    â”œâ”€â”€ kamailio/
    â”œâ”€â”€ drachtio/
    â””â”€â”€ freeswitch/
```

---

## ğŸŒ Network Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Docker Network: voip-network                 â”‚
â”‚                    Subnet: 172.20.0.0/16                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Service IP Allocation (Dynamic - via Docker DNS):
â”œâ”€â”€ nginx              â†’ 172.20.0.2
â”œâ”€â”€ kamailio           â†’ 172.20.0.3
â”œâ”€â”€ drachtio-1         â†’ 172.20.0.4
â”œâ”€â”€ drachtio-2         â†’ 172.20.0.5
â”œâ”€â”€ drachtio-app-1     â†’ 172.20.0.6
â”œâ”€â”€ drachtio-app-2     â†’ 172.20.0.7
â”œâ”€â”€ freeswitch-1       â†’ 172.20.0.8
â”œâ”€â”€ freeswitch-2       â†’ 172.20.0.9
â”œâ”€â”€ rtpengine          â†’ 172.20.0.10
â”œâ”€â”€ livekit            â†’ 172.20.0.11
â”œâ”€â”€ tts-service        â†’ 172.20.0.12
â”œâ”€â”€ postgres           â†’ 172.20.0.13
â”œâ”€â”€ redis              â†’ 172.20.0.14
â”œâ”€â”€ admin-dashboard    â†’ 172.20.0.15
â”œâ”€â”€ dsiprouter         â†’ 172.20.0.16
â””â”€â”€ pgadmin            â†’ 172.20.0.17

DNS Resolution:
All services use hostname-based communication:
  drachtio-app-1 â†’ http://tts-service:8000
  kamailio â†’ sip:drachtio-1:5060
  drachtio-app â†’ postgres:5432

NAT/Firewall Traversal:
â”œâ”€â”€ ICE (Interactive Connectivity Establishment)
â”œâ”€â”€ STUN (Session Traversal Utilities for NAT)
â”œâ”€â”€ TURN (Traversal Using Relays around NAT)
â””â”€â”€ RTPEngine handles WebRTC â†” SIP NAT
```

---

## ğŸ” Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SECURITY LAYERS                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Network Isolation
   â””â”€â”€ All services in private Docker network (voip-network)
   â””â”€â”€ Only NGINX exposed to public (port 80/443)

2. Authentication
   â”œâ”€â”€ Drachtio: Shared secret (drachtio_secret_2024)
   â”œâ”€â”€ FreeSWITCH ESL: Password (ClueCon)
   â”œâ”€â”€ PostgreSQL: Username/password
   â”œâ”€â”€ Redis: Password protection
   â””â”€â”€ LiveKit: API key/secret

3. Encryption
   â”œâ”€â”€ WebRTC: SRTP (Secure RTP)
   â”œâ”€â”€ SIP: TLS support (optional)
   â”œâ”€â”€ Database: SSL connections (optional)
   â””â”€â”€ API: HTTPS (when configured)

4. Access Control
   â”œâ”€â”€ Admin Dashboard: Token-based auth (recommended)
   â”œâ”€â”€ Database: pgAdmin requires login
   â””â”€â”€ Management UIs: Network-level restriction

5. Rate Limiting
   â”œâ”€â”€ Kamailio: SIP flood protection
   â”œâ”€â”€ NGINX: Request rate limits
   â””â”€â”€ Redis: Connection limits

6. Logging & Monitoring
   â”œâ”€â”€ All services log to stdout/stderr
   â”œâ”€â”€ Docker logs available via docker-compose logs
   â”œâ”€â”€ Admin Dashboard provides real-time monitoring
   â””â”€â”€ Call logs stored in PostgreSQL
```

---

This is Part 1 of the complete architecture documentation. Continuing in next file...
