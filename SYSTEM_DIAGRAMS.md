# System Diagrams - Visual Architecture Guide

## ğŸ“Š Table of Contents

1. [Component Interaction Diagrams](#component-interaction-diagrams)
2. [Call Flow Sequences](#call-flow-sequences)
3. [Data Flow Diagrams](#data-flow-diagrams)
4. [Deployment Architecture](#deployment-architecture)
5. [Network Topology](#network-topology)

---

## Component Interaction Diagrams

### ğŸ¯ WebRTC Call Setup Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚                                           â”‚   Browser   â”‚
â”‚   (Alice)   â”‚                                           â”‚    (Bob)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                                          â”‚
       â”‚ â‘                                                         â”‚
       â”‚ getUserMedia()                                           â”‚
       â”‚ (Get microphone)                                         â”‚
       â”‚                                                          â”‚
       â–¼                                                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           NGINX                                      â”‚
â”‚                        Port: 80, 8080                                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                                       â”‚
       â”‚ â‘¡ WebSocket                                          â”‚
       â”‚ SIP INVITE                                            â”‚
       â–¼                                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         KAMAILIO                                     â”‚
â”‚                    SIP Proxy & Load Balancer                         â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Dispatcher Module:                                          â”‚   â”‚
â”‚  â”‚  â€¢ Round-robin load balancing                               â”‚   â”‚
â”‚  â”‚  â€¢ Health checking                                           â”‚   â”‚
â”‚  â”‚  â€¢ Failover                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                               â”‚
       â”‚ â‘¢ Route to                    â”‚ â‘¢ Route to
       â”‚ Drachtio-1                    â”‚ Drachtio-2
       â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Drachtio-1      â”‚          â”‚  Drachtio-2      â”‚
â”‚  Port: 5080      â”‚          â”‚  Port: 5081      â”‚
â”‚  Control: 9022   â”‚          â”‚  Control: 9023   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                             â”‚
     â”‚ â‘£ Control Protocol          â”‚
     â”‚ (JSON over TCP)             â”‚
     â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Drachtio-App-1   â”‚          â”‚ Drachtio-App-2   â”‚
â”‚  (Node.js)       â”‚          â”‚  (Node.js)       â”‚
â”‚                  â”‚          â”‚                  â”‚
â”‚  async function  â”‚          â”‚  async function  â”‚
â”‚  handleCall() {  â”‚          â”‚  handleCall() {  â”‚
â”‚    // Route call â”‚          â”‚    // Route call â”‚
â”‚    if (ext==9999)â”‚          â”‚    if (ext==9999)â”‚
â”‚      IVR()       â”‚          â”‚      IVR()       â”‚
â”‚  }               â”‚          â”‚  }               â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                             â”‚
     â”‚ â‘¤ mrf.connect()             â”‚
     â”‚ (FreeSWITCH ESL)            â”‚
     â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FreeSWITCH-1    â”‚          â”‚  FreeSWITCH-2    â”‚
â”‚  ESL: 8021       â”‚          â”‚  ESL: 8021       â”‚
â”‚  RTP: 16384-16583â”‚          â”‚  RTP: 16584-16783â”‚
â”‚                  â”‚          â”‚                  â”‚
â”‚  â‘¥ endpoint.play â”‚          â”‚                  â”‚
â”‚  ("/output/      â”‚          â”‚                  â”‚
â”‚   audio.wav")    â”‚          â”‚                  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ â‘¦ RTP Stream
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RTPEngine                          â”‚
â”‚           Media Gateway                         â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  WebRTC â†” RTP Translation                â”‚  â”‚
â”‚  â”‚  â€¢ SRTP decryption                       â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Opus â†’ G.711 transcoding           â”‚  â”‚
â”‚  â”‚  â€¢ NAT traversal (ICE)                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ â‘§ SRTP
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚
â”‚   (Alice)   â”‚
â”‚  ğŸ”Š Audio   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ğŸ™ï¸ IVR Call Flow with TTS

```
Browser          Kamailio        Drachtio       App          FreeSWITCH      TTS Service
  â”‚                 â”‚               â”‚            â”‚                â”‚               â”‚
  â”‚ INVITE 9999     â”‚               â”‚            â”‚                â”‚               â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚            â”‚                â”‚               â”‚
  â”‚                 â”‚ INVITE        â”‚            â”‚                â”‚               â”‚
  â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚                â”‚               â”‚
  â”‚                 â”‚               â”‚ event      â”‚                â”‚               â”‚
  â”‚                 â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚               â”‚
  â”‚                 â”‚               â”‚            â”‚                â”‚               â”‚
  â”‚                 â”‚               â”‚            â”‚ mrf.connect()  â”‚               â”‚
  â”‚                 â”‚               â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
  â”‚                 â”‚               â”‚            â”‚                â”‚               â”‚
  â”‚                 â”‚               â”‚            â”‚ connectCaller()â”‚               â”‚
  â”‚                 â”‚               â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
  â”‚                 â”‚               â”‚            â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
  â”‚                 â”‚               â”‚            â”‚  endpoint      â”‚               â”‚
  â”‚                 â”‚               â”‚            â”‚                â”‚               â”‚
  â”‚                 â”‚ 200 OK        â”‚            â”‚                â”‚               â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚               â”‚
  â”‚                                              â”‚                â”‚               â”‚
  â”‚ ACK                                          â”‚                â”‚               â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚               â”‚
  â”‚                                              â”‚                â”‚               â”‚
  â”‚                                              â”‚ POST /tts      â”‚               â”‚
  â”‚                                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                                              â”‚ {"text":       â”‚               â”‚
  â”‚                                              â”‚  "Welcome..."}â”‚               â”‚
  â”‚                                              â”‚                â”‚               â”‚
  â”‚                                              â”‚                â”‚  â‘  Generate  â”‚
  â”‚                                              â”‚                â”‚     with      â”‚
  â”‚                                              â”‚                â”‚     Piper     â”‚
  â”‚                                              â”‚                â”‚               â”‚
  â”‚                                              â”‚                â”‚  â‘¡ Save to   â”‚
  â”‚                                              â”‚                â”‚   /app/output â”‚
  â”‚                                              â”‚                â”‚     /abc.wav  â”‚
  â”‚                                              â”‚                â”‚               â”‚
  â”‚                                              â”‚ file_path      â”‚               â”‚
  â”‚                                              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                              â”‚ "/app/output/  â”‚               â”‚
  â”‚                                              â”‚  abc.wav"      â”‚               â”‚
  â”‚                                              â”‚                â”‚               â”‚
  â”‚                                              â”‚ endpoint.play()â”‚               â”‚
  â”‚                                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
  â”‚                                              â”‚ (/app/output/  â”‚               â”‚
  â”‚                                              â”‚  abc.wav)      â”‚               â”‚
  â”‚                                              â”‚                â”‚               â”‚
  â”‚                                              â”‚                â”‚ â‘¢ Stream RTP â”‚
  â”‚ â—„â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¡               â”‚
  â”‚ [Audio: "Welcome to our service. Press 1..."]                â”‚               â”‚
  â”‚                                              â”‚                â”‚               â”‚
  â”‚ DTMF: 1                                      â”‚                â”‚               â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€RTPâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
  â”‚                                              â”‚                â”‚               â”‚
  â”‚                                              â”‚ DTMF event     â”‚               â”‚
  â”‚                                              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
  â”‚                                              â”‚ {"dtmf":"1"}   â”‚               â”‚
  â”‚                                              â”‚                â”‚               â”‚
  â”‚                                              â”‚ handleDTMF(1)  â”‚               â”‚
  â”‚                                              â”‚                â”‚               â”‚
  â”‚                                              â”‚ DB Query       â”‚               â”‚
  â”‚                                              â”‚ (get action)   â”‚               â”‚
  â”‚                                              â”‚                â”‚               â”‚
  â”‚                                              â”‚ POST /tts      â”‚               â”‚
  â”‚                                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                                              â”‚ "Transferring" â”‚               â”‚
  â”‚                                              â”‚                â”‚               â”‚
  â”‚ â—„â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¡               â”‚
  â”‚ [Audio: "Transferring to sales..."]         â”‚                â”‚               â”‚
  â”‚                                              â”‚                â”‚               â”‚
```

---

### ğŸ”„ TTS Service Internal Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        TTS Service (Port 8000)                       â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  FastAPI Application                                        â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚  POST /tts â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚    â”‚
â”‚  â”‚  POST /tts/phrase â”€â”¤                                        â”‚    â”‚
â”‚  â”‚  GET /voices â”€â”€â”€â”€â”€â”€â”¤                                        â”‚    â”‚
â”‚  â”‚  GET /health â”€â”€â”€â”€â”€â”€â”¤                                        â”‚    â”‚
â”‚  â”‚  GET /cache/clear â”€â”˜                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚               â”‚                                                     â”‚
â”‚               â–¼                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Request Handler                                             â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  1. Parse request                                            â”‚  â”‚
â”‚  â”‚     â”œâ”€ text: "Welcome to our service"                       â”‚  â”‚
â”‚  â”‚     â”œâ”€ voice: "default"                                     â”‚  â”‚
â”‚  â”‚     â”œâ”€ speed: 1.0                                           â”‚  â”‚
â”‚  â”‚     â””â”€ cache: true                                          â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  2. Generate cache key                                       â”‚  â”‚
â”‚  â”‚     cache_key = SHA256(text + voice + speed)                â”‚  â”‚
â”‚  â”‚     â†’ "a3f2c9d8e1b4..."                                     â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                â”‚                                                   â”‚
â”‚                â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Cache Check                                                 â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  if file_exists(f"/app/cache/{cache_key}.wav"):            â”‚  â”‚
â”‚  â”‚      return cached_file  â”€â”€â”€â”€â”                              â”‚  â”‚
â”‚  â”‚  else:                        â”‚                              â”‚  â”‚
â”‚  â”‚      generate_new()           â”‚                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â”‚                                 â”‚
â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                â”‚ Cache HIT                                         â”‚
â”‚                â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Return Cached File                                          â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  {                                                            â”‚  â”‚
â”‚  â”‚    "success": true,                                          â”‚  â”‚
â”‚  â”‚    "file_path": "/app/output/a3f2c9d8.wav",                â”‚  â”‚
â”‚  â”‚    "cached": true,                                          â”‚  â”‚
â”‚  â”‚    "duration": 2.1                                          â”‚  â”‚
â”‚  â”‚  }                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚                Cache MISS                                           â”‚
â”‚                â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Piper TTS Engine                                            â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  â‘  Load ONNX Model                                          â”‚  â”‚
â”‚  â”‚     /app/models/en_US-lessac-medium.onnx                   â”‚  â”‚
â”‚  â”‚     (63MB neural network)                                   â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  â‘¡ Text â†’ Phonemes                                          â”‚  â”‚
â”‚  â”‚     "Welcome to our service"                                â”‚  â”‚
â”‚  â”‚     â†’ /ËˆwÉ›lkÉ™m tu aÊŠr ËˆsÉvÉªs/                              â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  â‘¢ Phonemes â†’ Audio Samples                                 â”‚  â”‚
â”‚  â”‚     Neural synthesis (22050 Hz)                             â”‚  â”‚
â”‚  â”‚     Generate waveform                                       â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  â‘£ Apply Speed Adjustment                                   â”‚  â”‚
â”‚  â”‚     speed=1.0 (normal)                                      â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  â‘¤ Save WAV File                                            â”‚  â”‚
â”‚  â”‚     /app/output/a3f2c9d8.wav                               â”‚  â”‚
â”‚  â”‚     Format: 16-bit PCM, 22050 Hz, mono                     â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                â”‚                                                   â”‚
â”‚                â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Cache Storage                                               â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  Copy to cache:                                              â”‚  â”‚
â”‚  â”‚  /app/cache/a3f2c9d8.wav                                    â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  Update metadata:                                            â”‚  â”‚
â”‚  â”‚  - Created: 2026-01-04 01:00:00                             â”‚  â”‚
â”‚  â”‚  - Size: 78 KB                                              â”‚  â”‚
â”‚  â”‚  - Duration: 2.1 seconds                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                â”‚                                                   â”‚
â”‚                â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Return Response                                             â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  {                                                            â”‚  â”‚
â”‚  â”‚    "success": true,                                          â”‚  â”‚
â”‚  â”‚    "file_path": "/app/output/a3f2c9d8.wav",                â”‚  â”‚
â”‚  â”‚    "cached": false,                                         â”‚  â”‚
â”‚  â”‚    "duration": 2.1                                          â”‚  â”‚
â”‚  â”‚  }                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Shared Volume                                 â”‚
â”‚                                                                      â”‚
â”‚  /app/output/  â—„â”€â”€â”€ Mounted in both TTS Service & FreeSWITCH       â”‚
â”‚  â”œâ”€â”€ a3f2c9d8.wav                                                   â”‚
â”‚  â”œâ”€â”€ b7e4d1f2.wav                                                   â”‚
â”‚  â””â”€â”€ c9a5e3b1.wav                                                   â”‚
â”‚                                                                      â”‚
â”‚  FreeSWITCH can play any file in /app/output/                      â”‚
â”‚  endpoint.play("/app/output/a3f2c9d8.wav")                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ğŸ“Š Database Schema Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PostgreSQL Database: voip_db                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      call_logs          â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ ğŸ”‘ call_id VARCHAR(255) â”‚â”€â”€â”
â”‚    from_number          â”‚  â”‚
â”‚    to_number            â”‚  â”‚
â”‚    status               â”‚  â”‚
â”‚    start_time           â”‚  â”‚
â”‚    end_time             â”‚  â”‚
â”‚    duration             â”‚  â”‚
â”‚    recording_url        â”‚  â”‚
â”‚    created_at           â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                             â”‚
                             â”‚ 1:1
                             â”‚
                             â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚    active_calls         â”‚
              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
              â”‚ ğŸ”‘ id SERIAL            â”‚
              â”‚ ğŸ”— call_id VARCHAR(255) â”‚
              â”‚    from_number          â”‚
              â”‚    to_number            â”‚
              â”‚ ğŸ”— agent_extension      â”‚â”€â”€â”
              â”‚    status               â”‚  â”‚
              â”‚    started_at           â”‚  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                           â”‚
                                           â”‚ N:1
                                           â”‚
                                           â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚       agents            â”‚
                            â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                            â”‚ ğŸ”‘ id SERIAL            â”‚
                            â”‚ ğŸ” extension VARCHAR(20)â”‚
                            â”‚    name                 â”‚
                            â”‚    email                â”‚
                            â”‚    status               â”‚
                            â”‚    current_calls        â”‚
                            â”‚    total_calls          â”‚
                            â”‚    created_at           â”‚
                            â”‚    updated_at           â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ivr_menus           â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ ğŸ”‘ id SERIAL            â”‚
â”‚ ğŸ” menu_id VARCHAR(50)  â”‚â”€â”€â”
â”‚    name                 â”‚  â”‚
â”‚    welcome_message      â”‚  â”‚
â”‚    created_at           â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                             â”‚
                             â”‚ 1:N
                             â”‚
                             â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  ivr_menu_options       â”‚
              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
              â”‚ ğŸ”‘ id SERIAL            â”‚
              â”‚ ğŸ”— menu_id VARCHAR(50)  â”‚
              â”‚    digit VARCHAR(1)     â”‚
              â”‚    action_type          â”‚
              â”‚    action_value         â”‚
              â”‚    created_at           â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Legend:
ğŸ”‘ = Primary Key
ğŸ” = Unique Key
ğŸ”— = Foreign Key
```

---

### ğŸŒ Network Topology

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Internet / Public Network                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ Port 80 (HTTP)
                                 â”‚ Port 443 (HTTPS)
                                 â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    Host Machine         â”‚
                    â”‚  (Docker Host)          â”‚
                    â”‚                         â”‚
                    â”‚  Public IP: x.x.x.x    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ Docker Bridge
                                 â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         Docker Network: voip-network             â”‚
        â”‚         Subnet: 172.20.0.0/16                    â”‚
        â”‚         DNS: Automatic (container names)         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”œâ”€â”€â”€ 172.20.0.2   nginx
                â”œâ”€â”€â”€ 172.20.0.3   kamailio
                â”œâ”€â”€â”€ 172.20.0.4   drachtio-1
                â”œâ”€â”€â”€ 172.20.0.5   drachtio-2
                â”œâ”€â”€â”€ 172.20.0.6   drachtio-app-1
                â”œâ”€â”€â”€ 172.20.0.7   drachtio-app-2
                â”œâ”€â”€â”€ 172.20.0.8   freeswitch-1
                â”œâ”€â”€â”€ 172.20.0.9   freeswitch-2
                â”œâ”€â”€â”€ 172.20.0.10  rtpengine
                â”œâ”€â”€â”€ 172.20.0.11  livekit
                â”œâ”€â”€â”€ 172.20.0.12  tts-service
                â”œâ”€â”€â”€ 172.20.0.13  postgres
                â”œâ”€â”€â”€ 172.20.0.14  redis
                â”œâ”€â”€â”€ 172.20.0.15  admin-dashboard
                â”œâ”€â”€â”€ 172.20.0.16  dsiprouter
                â””â”€â”€â”€ 172.20.0.17  pgadmin

Service Communication Examples:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                   â”‚
â”‚  drachtio-app-1 (172.20.0.6)                                    â”‚
â”‚       â”œâ”€â†’ postgres:5432        (172.20.0.13)                    â”‚
â”‚       â”œâ”€â†’ redis:6379           (172.20.0.14)                    â”‚
â”‚       â”œâ”€â†’ drachtio-1:9022      (172.20.0.4)                     â”‚
â”‚       â”œâ”€â†’ freeswitch-1:8021    (172.20.0.8)                     â”‚
â”‚       â””â”€â†’ tts-service:8000     (172.20.0.12)                    â”‚
â”‚                                                                   â”‚
â”‚  Uses container names (DNS auto-resolves to IP)                 â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Deployment Architecture

### ğŸ—ï¸ Container Dependencies

```
Startup Order (8 Layers):

Layer 1: Foundation
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL  â”‚    â”‚   Redis     â”‚
â”‚  (1st)      â”‚    â”‚   (1st)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
Layer 2: Support Services
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  pgAdmin    â”‚    â”‚ TTS Service â”‚
â”‚  (2nd)      â”‚    â”‚  (2nd)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 3: Media Infrastructure
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RTPEngine  â”‚    â”‚ FreeSWITCH-1 â”‚    â”‚ FreeSWITCH-2 â”‚
â”‚  (3rd)      â”‚    â”‚  (3rd)       â”‚    â”‚  (3rd)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 4: SIP Infrastructure
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Drachtio-1   â”‚    â”‚ Drachtio-2   â”‚
â”‚  (4th)       â”‚    â”‚  (4th)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 5: SIP Proxy
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Kamailio   â”‚
â”‚  (5th)      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
Layer 6: Application
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Drachtio-App-1â”‚  â”‚ Drachtio-App-2â”‚  â”‚ LiveKit  â”‚
â”‚  (6th)        â”‚  â”‚  (6th)        â”‚  â”‚ (6th)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 7: Management
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  dSIPRouter  â”‚    â”‚ Admin Dashboard  â”‚
â”‚  (7th)       â”‚    â”‚  (7th)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 8: Web Layer
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    NGINX    â”‚
â”‚  (8th/last) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Health Check Flow:
Each service waits for dependencies to be "healthy" before starting
```

---

### ğŸ”„ High Availability Setup

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Load Balanced Components                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SIP Signaling (Active-Active):
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Kamailio   â”‚
        â”‚ (Dispatcher) â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚
        â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Drachtio-1   â”‚  â”‚ Drachtio-2   â”‚
â”‚  + App-1     â”‚  â”‚  + App-2     â”‚
â”‚              â”‚  â”‚              â”‚
â”‚  â€¢ Port 5080 â”‚  â”‚  â€¢ Port 5081 â”‚
â”‚  â€¢ 50% load  â”‚  â”‚  â€¢ 50% load  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Media Processing (Active-Active):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚FreeSWITCH-1  â”‚  â”‚FreeSWITCH-2  â”‚
â”‚              â”‚  â”‚              â”‚
â”‚  â€¢ Port 5062 â”‚  â”‚  â€¢ Port 5063 â”‚
â”‚  â€¢ RTP Pool  â”‚  â”‚  â€¢ RTP Pool  â”‚
â”‚  16384-16583 â”‚  â”‚  16584-16783 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Shared State (Active-Passive):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL   â”‚       â”‚    Redis     â”‚
â”‚  (Primary)   â”‚       â”‚  (Primary)   â”‚
â”‚              â”‚       â”‚              â”‚
â”‚  Future:     â”‚       â”‚  Future:     â”‚
â”‚  + Replica   â”‚       â”‚  + Sentinel  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Failover Scenarios:
1. Drachtio-1 fails â†’ Kamailio routes all to Drachtio-2
2. FreeSWITCH-1 fails â†’ Apps use FreeSWITCH-2
3. App-1 fails â†’ Drachtio-1 has no control (restarts)
```

Continuing in SERVICE_DETAILS_PART2.md...
